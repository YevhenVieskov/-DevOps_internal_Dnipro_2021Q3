user_data

The user_data only runs at instance launch time.

Here is a sample of using user_data embedded into tf file:

provider "aws" {
	region = "us-east-1"
}

resource "aws_key_pair" "terraform-demo" {
  key_name   = "terraform-demo"
  public_key = "${file("terraform-demo.pub")}"
}

resource "aws_instance" "my-instance" {
	ami = "ami-04169656fea786776"
	instance_type = "t2.nano"
	key_name = "${aws_key_pair.terraform-demo.key_name}"
	user_data = << EOF
		#! /bin/bash
                sudo apt-get update
		sudo apt-get install -y apache2
		sudo systemctl start apache2
		sudo systemctl enable apache2
		echo "<h1>Deployed via Terraform</h1>" | sudo tee /var/www/html/index.html
	EOF
	tags = {
		Name = "Terraform"	
		Batch = "5AM"
	}
}


But we prefer to use a file() function:

provider "aws" {
	region = "us-east-1"
}

resource "aws_key_pair" "terraform-demo" {
  key_name   = "terraform-demo"
  public_key = "${file("terraform-demo.pub")}"
}

resource "aws_instance" "my-instance" {
	ami = "ami-04169656fea786776"
	instance_type = "t2.nano"
	key_name = "${aws_key_pair.terraform-demo.key_name}"
	user_data = "${file("install_apache.sh")}"
	tags = {
		Name = "Terraform"	
		Batch = "5AM"
	}
}


The install_apache.sh looks like this:

#! /bin/bash
sudo apt-get update
sudo apt-get install -y apache2
sudo systemctl start apache2
sudo systemctl enable apache2
echo "<h1>Deployed via Terraform</h1>" | sudo tee /var/www/html/index.html


data "local_file" "InstallJenkins" {
  filename = "${path.module}/InstallJenkins.sh"
}




#EC2 Instance
resource "aws_instance" "JenkinsServer" {
  ami = "${data.aws_ami.UbuntuLatest.id}"
  instance_type = "${var.Ec2Type}"
  key_name = "${var.KeyName}"
  subnet_id = "${var.SubnetId}"
  vpc_security_group_ids = ["${var.SecurityGroupCreated}"]
  user_data = "${data.local_file.InstallJenkins.content}"

  tags = {
    Name = "${var.Ec2Name}"
  }
}